"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createAngularEditorExtension = void 0;
const fs = require("fs/promises");
const path = require("path");
const editorextension_1 = require("./editorextension");
const installationutil_1 = require("./installationutil");
const package_1 = require("./package");
const theme_1 = require("./theme");
async function createAngularEditorExtension(name, isInternal, skipSDKDependency) {
    await (0, editorextension_1.createEditorExtension)(name, isInternal, skipSDKDependency, path.join('angular', 'skeleton'), [
        'webpack-shell-plugin-next',
    ]);
    const angularProjectName = name;
    const angularEditorExtensionTargetFolder = path.join(process.cwd(), angularProjectName);
    console.log((0, theme_1.success)('Creating Angular project in ' + angularEditorExtensionTargetFolder));
    (0, installationutil_1.installAngularProject)(angularProjectName);
    const webpackConfig = (await fs.readFile('webpack.config.js', 'utf8')).replace('<<dynamicname>>', angularProjectName);
    const extensionTemplateCode = (await fs.readFile(path.join('src', 'extension.ts'), 'utf8')).replace('<<dynamicname>>', angularProjectName);
    await fs.writeFile(path.join(process.cwd(), 'webpack.config.js'), webpackConfig);
    await fs.writeFile(path.join('src', 'extension.ts'), extensionTemplateCode);
    process.chdir(path.join(angularProjectName));
    const packageJson = await (0, package_1.readJson)('package.json');
    packageJson.name = angularProjectName;
    await fs.writeFile('package.json', JSON.stringify(packageJson, null, 4));
    console.log('Installing Angular dependencies');
    (0, installationutil_1.installDependenciesIfNeeded)(isInternal, skipSDKDependency);
}
exports.createAngularEditorExtension = createAngularEditorExtension;
